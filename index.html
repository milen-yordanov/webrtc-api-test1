<!DOCTYPE html>
<!--
 *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
-->
<html>
<head>

    <meta charset="utf-8">
    <meta name="description" content="WebRTC code samples">
    <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">
    <meta itemprop="description" content="Client-side WebRTC code samples">
    <meta itemprop="name" content="WebRTC code samples">
    <meta name="mobile-web-app-capable" content="yes">
    <meta id="theme-color" name="theme-color" content="#ffffff">

    <base target="_blank">

    <title>Peer connection - upgrade</title>

    <link href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/main2.css"/>
    <link rel="stylesheet" href="css/main.css"/>

</head>

<body>

<div id="container">
    <h1>WebRTC samples. Video ON / OFF.</h1>

    <video id="localVideo" playsinline autoplay muted></video>
    <video id="remoteVideo" playsinline autoplay></video>

    <div>
        <button id="startButton">Start</button>
        <button id="callButton">Call</button>
        <button id="videoOnButton">Turn ON video</button>
        <button id="videoOffButton">Turn OFF video</button>
        <button id="hangupButton">Hang Up</button>
    </div>

    <p>On mobile Safari do these steps:
        <ol>
            <li>Click Start</li>
            <li>Click Call</li>
            <li>Turn ON video, Turn OFF video</li>
            <li>Turn ON video, Turn OFF video</li>
            <li>Turn ON video, Turn OFF video</li>
            <li>Turn ON video, Turn OFF video</li>
            <li>Turn ON video, Turn OFF video</li>
        </ol>
    </p>

    <p>
        The app eventually will exhaust all HW H.264 encoders and will fail. The remote video will be black when the local video is playing.
        Tested on iPad Mini 2, iOS 12.4
        The device log says:
<pre>
mediaserverd	H.264-legacy: Init hw video encoder: dimension = 640 x 480, usage = 1
mediaserverd	AVE: Bottom extended pixels = 8
mediaserverd	Assert - (false) - f: /BuildRoot/Library/Caches/com.apple.xbs/Sources/AppleVXE380/AppleVXE380-445.6/Library/AppleVXE380FIGwrapper.cpp l: 3166
kernel	H264SecurityCheck WARNING: m_NumberOfClients reached MAX 4
kernel	VXE380 WARNING: m_ClientsSecurityCheck->AddClient failed
mediaserverd	VXE FIG ERROR: kVTVideoEncoderNotAvailableNowErr.
mediaserverd	Assert - (pDriverInstance) - f: /BuildRoot/Library/Caches/com.apple.xbs/Sources/AppleVXE380/AppleVXE380-445.6/Library/AppleVXE380UserLandLibrary.cpp l: 648
mediaserverd	AppleVXE380VA ERROR: AppleVXE380VA_DriverDelete, pDriverInstance NULL.
mediaserverd	Assert - (err == noErr) - f: /BuildRoot/Library/Caches/com.apple.xbs/Sources/AppleVXE380/AppleVXE380-445.6/Library/AppleVXE380FIGwrapper.cpp l: 3302
mediaserverd	VXE FIG ERROR: AppleVXE380VA_DriverDelete failed.
mediaserverd	H.264: failed to init video encoder, err = -108
</pre>
    </p>
    <p>v1</p>
</div>

<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
<script src="js/main.js" async></script>

</body>
</html>
